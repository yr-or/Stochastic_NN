import matplotlib.pyplot as plt
from sklearn.metrics import mean_absolute_error
import numpy as np

def bipolar_to_prob(y):
    return (y+1)/2

def bipolar_to_prob_int(y):
    return int(bipolar_to_prob(y)*256)

def prob_to_bipolar(x):
    return (2*x)-1

def prob_int_to_bipolar(x):
    return prob_to_bipolar(x/256)

def prob_int9_to_bipolar(x):
    return prob_to_bipolar(x/512)

def prob_int10_to_bipolar(x):
    return prob_to_bipolar(x/1024)

def prob_int11_to_bipolar(x):
    return prob_to_bipolar(x/2048)

def prob_int12_to_bipolar(x):
    return prob_to_bipolar(x/4096)

def prob_int16_to_bipolar(x):
    return prob_to_bipolar(x/65536)

def prob_int12_to_bipolar(x):
    return prob_to_bipolar(x/4096)

def prob_int16_to_unipolar(x):
    return x/65536



test_data_num1 = [62304, 26811, 1712, 65034, 51975, 59168, 60247, 9421, 35430, 33138, 42687, 35101, 29988, 45388, 19520, 35819, 29822, 47092, 23249, 1230, 31663, 349, 19364, 30601, 51418, 28084, 33669, 57056, 33976, 35295, 19858, 12844, 36598, 52443, 27092, 64337, 14606, 19361, 56859, 5656, 17126, 44689, 48587, 59408, 21050, 8569, 59091, 42942, 1836, 31640, 47563, 23389, 30301, 16376, 36333, 50389, 9856, 55854, 26205, 12909, 40639, 26464, 57875, 29263, 25166, 22609, 14594, 17022, 20481, 21680, 38744, 51319, 11636, 58515, 6045, 13511, 40222, 37809, 18279, 17005, 3109, 57803, 36248, 65283, 27116, 57547, 46399, 6253, 7880, 25182, 40644, 18617, 41746, 42864, 34033, 30833, 20147, 3019, 46749, 61418]
test_data_num2 = [62499, 2267, 24782, 52510, 41881, 18988, 65375, 55186, 6987, 61889, 62720, 47020, 14333, 44455, 11210, 47934, 49257, 52027, 10969, 37453, 24881, 8387, 52999, 39493, 9709, 33591, 16336, 31757, 8100, 26954, 50586, 42970, 52868, 50710, 48812, 8001, 4552, 40733, 52838, 1220, 36097, 12513, 61776, 31216, 56560, 8500, 63934, 24437, 61548, 38043, 53169, 32777, 24221, 28784, 36078, 53278, 14463, 21366, 38364, 21975, 50564, 1495, 34951, 4355, 22192, 2754, 38655, 43539, 64336, 17778, 18239, 32978, 18962, 5101, 49493, 12993, 14743, 38218, 55034, 11872, 33066, 13251, 10052, 17965, 24388, 53545, 34640, 50768, 12195, 51590, 51927, 56765, 31594, 46137, 56639, 617, 41276, 57683, 31685, 42786]


num1_float = [prob_int16_to_bipolar(x) for x in test_data_num1]
num2_float = [prob_int16_to_bipolar(x) for x in test_data_num2]

mul_float = [num1_float[i]*num2_float[i] for i in range(100)]



test_mul_res_256_viv = [236,233,232,229,225,227,228,235,227,228,222,220,226,223,222,217,148,149,135,161,148,138,137,146,126,133,130,139,139,130,139,119,122,123,144,148,147,139,143,130,132,121,151,131,132,135,115,131,161,165,156,167,168,169,157,155,168,154,168,160,160,163,157,164,117,125,116,106,102,123,116,107,97,125,106,104,96,103,113,92,54,69,54,60,59,58,66,64,52,58,52,52,47,45,44,49,152,150,150,143]
test_mul_res_512_viv = [469,464,458,471,466,454,465,458,309,309,304,301,281,291,292,285,274,323,318,304,295,324,312,287,389,388,399,371,394,397,400,404,296,280,275,291,281,274,269,263,165,149,162,181,152,160,128,144,429,427,419,422,424,421,425,410,137,105,99,128,120,121,129,104,210,207,210,198,205,200,215,211,226,224,210,239,220,217,225,238,306,275,293,258,286,293,277,231,220,223,230,214,210,219,195,226,208,221,201,213]
test_mul_res_1024_viv = [933,932,926,931,626,613,584,588,613,640,640,619,808,800,821,836,608,594,588,568,331,366,337,296,923,909,916,910,257,244,267,258,460,456,451,469,508,503,500,529,652,629,654,584,504,510,496,501,507,487,504,525,530,547,543,571,590,628,625,628,500,484,512,531,465,446,475,443,586,597,587,585,535,572,564,589,411,408,401,394,478,472,476,475,792,774,797,850,369,364,336,354,435,456,468,469,278,259,254,266]
test_mul_res_2048_viv = [1865,1858,1243,1173,1261,1268,1625,1676,1216,1174,708,643,1863,1861,519,539,939,950,1045,1056,1320,1279,1045,1028,1038,1063,1124,1152,1265,1307,1034,1092,964,960,1244,1246,1176,1222,861,838,1019,1010,1676,1763,772,729,965,1010,584,569,994,1002,950,979,976,988,970,957,984,985,769,780,774,808,1070,1062,1291,1298,923,934,266,275,1441,1455,879,913,1447,1449,1753,1785,907,970,753,760,1416,1393,937,961,727,733,1480,1532,1735,1719,910,917,172,166,991,926]
test_mul_res_4096_viv = [3723,2418,2532,3308,2393,1354,3741,1062,1899,2116,2622,2094,2119,2296,2595,2143,1952,2523,2437,1718,2058,3499,1529,2007,1171,2035,1968,1998,1972,2017,1591,1615,2182,2654,1904,573,2973,1839,2973,3643,1943,1562,2896,1956,1522,3116,3579,1900,348,1987,2635,1980,2064,2138,2042,2649,2839,1540,1963,2434,2310,2440,2107,2214,2198,2581,1829,1658,1261,2315,1873,2042,2578,690,1232,2735,1718,2065,1396,2677,1999,1050,1841,1127,2099,2973,2070,1145,2985,1761,2261,1369,1928,2238,2056,2109,1844,637,1999,2553]

mul_float_viv_8bit = [prob_int_to_bipolar(x) for x in test_mul_res_256_viv]
mul_float_viv_9bit = [prob_int9_to_bipolar(x) for x in test_mul_res_512_viv]
mul_float_viv_10bit = [prob_int10_to_bipolar(x) for x in test_mul_res_1024_viv]
mul_float_viv_11bit = [prob_int11_to_bipolar(x) for x in test_mul_res_2048_viv]
mul_float_viv_12bit = [prob_int12_to_bipolar(x) for x in test_mul_res_4096_viv]


MAE_256 = mean_absolute_error(mul_float, mul_float_viv_8bit)
MAE_512 = mean_absolute_error(mul_float, mul_float_viv_9bit)
MAE_1024 = mean_absolute_error(mul_float, mul_float_viv_10bit)
MAE_2048 = mean_absolute_error(mul_float, mul_float_viv_11bit)
MAE_4096 = mean_absolute_error(mul_float, mul_float_viv_12bit)

MAE_list = [MAE_256, MAE_512, MAE_1024, MAE_2048, MAE_4096]

x_vals = [256, 512, 1024, 2048, 4096]
plt.plot(x_vals, MAE_list)
plt.title("MAE of stochastic multiplication (100 tests each)")
plt.xlabel("Bitstream length")
plt.ylabel("MAE")
plt.grid()
plt.show()









